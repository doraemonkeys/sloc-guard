# ==============================================================================
# SlocGuard Configuration (Ideal State / Future V2)
# ==============================================================================
# This configuration reflects the architectural refactoring plan (Phase 5.5).
# 
# Sections:
# 1. [scanner]   - What files to look for (Discovery)
# 2. [content]   - Code size limits (SLOC Guard) + [[content.override]]
# 3. [structure] - File/Directory count limits (Structure Guard) + [[structure.override]]
#
# Rule Priority Chain (high → low):
#   Content: [[content.override]] > [[content.rules]] (last match) > [content.languages.X] > [content]
#   Structure: [[structure.override]] > [[structure.rules]] (last match) > [structure]
# ==============================================================================

version = "2.0" # Schema version

# ------------------------------------------------------------------------------
# Config Inheritance (extends)
# ------------------------------------------------------------------------------
# Inherit from a base configuration file (local or remote).
# Child config values override parent values (merge strategy).
# Use `--no-extends` CLI flag to disable inheritance.

# Local inheritance (relative or absolute path):
# extends = "../shared/.sloc-guard.toml"

# Remote inheritance (HTTP/HTTPS, cached for 1 hour):
# extends = "https://company.com/standards/sloc-guard-base.toml"

# After extends, override specific values as needed:
# [content]
# max_lines = 500  # Overrides base config's max_lines

# ------------------------------------------------------------------------------
# 1. Scanner Configuration (Physical Discovery)
# ------------------------------------------------------------------------------
# Scanner finds ALL files - no extension filtering here.
# This ensures Structure Guard sees the complete directory structure.
[scanner]
# Respect .gitignore rules (default: true)
gitignore = true

# Global exclude patterns (files/dirs to completely ignore by ALL checkers)
# These are ADDITIVE to .gitignore (union, not override).
exclude = [
    "node_modules/**",
    "target/**",
    "dist/**",
    "**/*.min.js",
    "vendor/**",
]

# ------------------------------------------------------------------------------
# 2. Content Guard (SLOC Limits)
# ------------------------------------------------------------------------------
# Replaces old [default] for checker settings.
# Extensions filter is HERE (not in scanner) - only these files get SLOC analysis.
[content]
extensions = [
    "rs",
    "ts",
    "tsx",
    "js",
    "go",
    "py",
    "c",
    "cpp",
] # Files for SLOC counting
max_lines = 400 # Global Red Line
warn_threshold = 0.8 # Warn at 320 lines
skip_comments = true # Don't count comments
skip_blank = true # Don't count blank lines

# --- Specific Content Rules ---

# Replaces old [[path_rules]] - Symmetry with [structure.rules]
[[content.rules]]
pattern = "src/ui/**" # UI Components
max_lines = 250       # Stricter limit for UI

[[content.rules]]
pattern = "tests/**" # Test files
max_lines = 1000     # Relaxed limit for tests

# Extension-based rules (pattern form)
[[content.rules]]
pattern = "**/*.test.ts"
max_lines = 1000

# --- Extension-Based Shorthand (Syntax Sugar) ---
# Equivalent to: [[content.rules]] pattern = "**/*.rs"
# Simpler for the common case of per-language limits.
# MUST support ALL fields that [[content.rules]] supports (field parity).
[content.languages.rs]
max_lines = 1000
warn_threshold = 0.9  # All fields supported
skip_comments = true
skip_blank = true

[content.languages.go]
max_lines = 800

# ------------------------------------------------------------------------------
# 3. Structure Guard (Directory Limits)
# ------------------------------------------------------------------------------
[structure]
# Fallback limits (applied to directories without specific rules)
max_files = 50
max_dirs = 10

# Files that exist but don't count towards the quota.
# Use for auxiliary files that don't contribute to complexity.
# NOTE: Different from scanner.exclude:
#   - scanner.exclude = ["*.svg"]     → Completely invisible to ALL checkers
#   - count_exclude = ["*.svg"]       → Visible, but doesn't count toward quota
count_exclude = ["README.md", "LICENSE", ".gitkeep", "*.css", "*.svg"]

# --- Scenario Rules ---
# NOTE: Patterns ONLY match directories. If a pattern matches a file, it's ignored.
# Glob semantics:
#   - "src/components/*"  → DIRECT children only (Button/, Icon/)
#   - "src/components/**" → ALL descendants recursively
#   - "src/features"      → Exact match only

# Atomic Components: Flat structure, few files (direct children only)
[[structure.rules]]
pattern = "src/components/*" # Matches src/components/Button/, NOT src/components/Button/Icon/
max_files = 5
max_dirs = 0                 # No nesting allowed

# Feature Modules: Allow sub-modules (exact match)
[[structure.rules]]
pattern = "src/features"
max_files = 5
max_dirs = 50

# ------------------------------------------------------------------------------
# 4. Grandfathering / Overrides
# ------------------------------------------------------------------------------
# Use this to adopt sloc-guard in existing projects without fixing everything immediately.
# Separated by concern: content (file SLOC) vs structure (directory counts).
# This provides type safety - can't accidentally set max_files on a file path.

# --- Content Overrides (File SLOC limits) ---
# Only for FILES. Loader validates path points to a file.
[[content.override]]
path = "src/legacy/god_object.rs"
max_lines = 5000
reason = "Legacy core, too risky to refactor. Scheduled for Q4."

[[content.override]]
path = "src/utils/complex_math.ts"
max_lines = 800
reason = "Algorithm implementation, irreducible complexity."

# --- Structure Overrides (Directory limits) ---
# Only for DIRECTORIES. Loader validates path points to a directory.
[[structure.override]]
path = "src/legacy_module"
max_files = 500
max_dirs = 100
reason = "Legacy monolith, gradual migration in progress."
